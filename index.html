<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SayurID</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar untuk tampilan yang lebih bersih */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #4ade80; /* Hijau Tailwind 400 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #22c55e; /* Hijau Tailwind 500 */
        }
        
        .page-content {
            padding-bottom: 80px; /* Jarak agar konten tidak tertutup navbar bawah */
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Konten Halaman Utama -->
    <div class="page-content container mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Halaman Home -->
        <div id="home-page" class="page active text-center py-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-green-600 mb-4">SayurID 🥦</h1>
            <p class="text-gray-600 text-lg mb-8 max-w-xl mx-auto">Menyediakan sayuran segar langsung dari petani, kualitas terbaik dengan harga terjangkau.</p>
            <button id="cta-katalog" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300">
                Lihat Katalog
            </button>
        </div>

        <!-- Halaman Katalog -->
        <div id="katalog-page" class="page">
            <h2 class="text-3xl font-bold text-green-700 mb-6">Katalog Sayuran</h2>
            <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Produk akan dimuat di sini oleh JavaScript -->
            </div>
        </div>

        <!-- Halaman Keranjang -->
        <div id="keranjang-page" class="page">
            <h2 class="text-3xl font-bold text-green-700 mb-6">Keranjang Belanja</h2>
            <div id="cart-list" class="space-y-4">
                <!-- Item keranjang akan dimuat di sini oleh JavaScript -->
            </div>
            <div id="cart-summary" class="mt-8 p-6 bg-white rounded-lg shadow-md border-t-2 border-green-500">
                <p class="text-lg font-semibold text-gray-800">Total: <span id="cart-total-price" class="text-xl font-bold text-green-600">Rp0</span></p>
                <button id="checkout-button" class="mt-4 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:opacity-50" disabled>
                    Checkout via WhatsApp
                </button>
            </div>
        </div>

        <!-- Halaman Login Admin -->
        <div id="login-page" class="page flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
                <h2 class="text-2xl font-bold text-center text-green-700 mb-6">Admin Login</h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="username" class="block text-gray-700 text-sm font-semibold mb-2">Username</label>
                        <input type="text" id="username" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-gray-700 text-sm font-semibold mb-2">Password</label>
                        <input type="password" id="password" class="shadow-sm appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-300">
                        Login
                    </button>
                    <p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden">Username atau password salah.</p>
                </form>
            </div>
        </div>

        <!-- Halaman Admin Panel -->
        <div id="admin-page" class="page">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-green-700">Admin Panel</h2>
                <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white text-sm font-bold py-2 px-4 rounded-lg transition duration-300">
                    Logout
                </button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md mb-8 border-t-2 border-green-500">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Tambah Produk Baru</h3>
                <form id="add-product-form" class="space-y-4">
                    <div>
                        <label for="product-name" class="block text-gray-700 font-semibold mb-1">Nama Produk</label>
                        <input type="text" id="product-name" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label for="product-price" class="block text-gray-700 font-semibold mb-1">Harga (Rp)</label>
                        <input type="number" id="product-price" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label for="product-desc" class="block text-gray-700 font-semibold mb-1">Deskripsi</label>
                        <textarea id="product-desc" rows="3" class="w-full p-2 border border-gray-300 rounded-lg" required></textarea>
                    </div>
                    <div>
                        <label for="product-image" class="block text-gray-700 font-semibold mb-1">Unggah Gambar</label>
                        <input type="file" id="product-image" accept="image/*" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-lg transition duration-300">
                        Tambah Produk
                    </button>
                </form>
            </div>
            
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Daftar Produk</h3>
            <div id="admin-product-list" class="space-y-4">
                <!-- Daftar produk admin akan dimuat di sini -->
            </div>
        </div>

    </div>

    <!-- Bottom Navbar -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50">
        <div class="flex justify-around items-center h-16">
            <button class="nav-button flex flex-col items-center text-sm text-gray-600 hover:text-green-500 transition-colors" data-page="home-page">
                🏠 <span class="mt-1">Home</span>
            </button>
            <button class="nav-button flex flex-col items-center text-sm text-gray-600 hover:text-green-500 transition-colors" data-page="katalog-page">
                🥦 <span class="mt-1">Katalog</span>
            </button>
            <button class="nav-button flex flex-col items-center text-sm text-gray-600 hover:text-green-500 transition-colors" data-page="keranjang-page">
                🛒 <span class="mt-1">Keranjang</span>
            </button>
            <button class="nav-button flex flex-col items-center text-sm text-gray-600 hover:text-green-500 transition-colors" data-page="login-page">
                ⚙️ <span class="mt-1">Admin</span>
            </button>
        </div>
    </nav>

    <!-- JavaScript untuk Fungsionalitas -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Data
            const WA_NUMBER = '+62 889-7189-7497'; // Ganti dengan nomor WhatsApp Anda
            const ADMIN_USERNAME = 'Admin';
            const ADMIN_PASSWORD = '123';

            // Elemen DOM
            const pages = document.querySelectorAll('.page');
            const navButtons = document.querySelectorAll('.nav-button');
            const ctaKatalog = document.getElementById('cta-katalog');
            const productList = document.getElementById('product-list');
            const cartList = document.getElementById('cart-list');
            const cartTotalPrice = document.getElementById('cart-total-price');
            const checkoutButton = document.getElementById('checkout-button');
            const loginForm = document.getElementById('login-form');
            const adminPage = document.getElementById('admin-page');
            const loginPage = document.getElementById('login-page');
            const logoutButton = document.getElementById('logout-button');
            const addProductForm = document.getElementById('add-product-form');
            const adminProductList = document.getElementById('admin-product-list');
            const loginError = document.getElementById('login-error');

            // Fungsi navigasi halaman
            const showPage = (pageId) => {
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');
                window.scrollTo(0, 0); // Gulir ke atas halaman saat pindah halaman
            };

            // Event listener untuk navigasi
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const page = button.getAttribute('data-page');
                    if (page === 'admin-page') {
                        // Jika Admin Panel, cek status login
                        if (localStorage.getItem('isLoggedIn') === 'true') {
                            showPage('admin-page');
                            renderAdminProducts();
                        } else {
                            showPage('login-page');
                        }
                    } else {
                        showPage(page);
                    }
                });
            });

            ctaKatalog.addEventListener('click', () => showPage('katalog-page'));

            // Inisialisasi data produk dari localStorage
            const getProducts = () => {
                const products = JSON.parse(localStorage.getItem('products')) || [];
                return products;
            };

            // Render produk di halaman Katalog
            const renderProducts = () => {
                productList.innerHTML = '';
                const products = getProducts();
                if (products.length === 0) {
                    productList.innerHTML = '<p class="text-center text-gray-500">Belum ada produk. Tambahkan produk dari halaman Admin.</p>';
                } else {
                    products.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'bg-white rounded-lg shadow-md overflow-hidden transform transition duration-300 hover:scale-105';
                        productCard.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                            <div class="p-4">
                                <h3 class="text-xl font-bold text-gray-800 mb-1">${product.name}</h3>
                                <p class="text-green-600 font-semibold mb-2">Rp${product.price.toLocaleString('id-ID')}</p>
                                <p class="text-gray-500 text-sm h-12 overflow-hidden mb-4">${product.description}</p>
                                <button data-id="${product.id}" class="add-to-cart-btn w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-lg transition duration-300">
                                    Tambah ke Keranjang
                                </button>
                            </div>
                        `;
                        productList.appendChild(productCard);
                    });
                }
            };

            // Fungsi Keranjang
            const getCart = () => JSON.parse(localStorage.getItem('cart')) || [];
            const saveCart = (cart) => localStorage.setItem('cart', JSON.stringify(cart));

            const renderCart = () => {
                const cart = getCart();
                cartList.innerHTML = '';
                let total = 0;

                if (cart.length === 0) {
                    cartList.innerHTML = '<p class="text-center text-gray-500">Keranjangmu kosong.</p>';
                    checkoutButton.disabled = true;
                } else {
                    checkoutButton.disabled = false;
                    cart.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'flex justify-between items-center bg-white p-4 rounded-lg shadow-sm';
                        itemElement.innerHTML = `
                            <div>
                                <h4 class="font-bold text-gray-800">${item.name}</h4>
                                <p class="text-gray-600 text-sm">${item.quantity} x Rp${item.price.toLocaleString('id-ID')}</p>
                            </div>
                            <div class="flex items-center">
                                <button data-id="${item.id}" class="remove-from-cart-btn bg-red-500 text-white p-1 rounded-full text-xs h-6 w-6 flex items-center justify-center">-</button>
                                <span class="mx-3 font-semibold text-gray-700">${item.quantity}</span>
                                <button data-id="${item.id}" class="add-to-cart-btn bg-green-500 text-white p-1 rounded-full text-xs h-6 w-6 flex items-center justify-center">+</button>
                            </div>
                        `;
                        cartList.appendChild(itemElement);
                        total += item.price * item.quantity;
                    });
                }
                cartTotalPrice.textContent = `Rp${total.toLocaleString('id-ID')}`;
            };

            const addToCart = (productId) => {
                const products = getProducts();
                const productToAdd = products.find(p => p.id == productId);
                let cart = getCart();
                const existingItem = cart.find(item => item.id == productId);

                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...productToAdd, quantity: 1 });
                }
                saveCart(cart);
                alert(`${productToAdd.name} ditambahkan ke keranjang!`);
                renderCart();
            };

            const removeFromCart = (productId) => {
                let cart = getCart();
                const existingItem = cart.find(item => item.id == productId);

                if (existingItem.quantity > 1) {
                    existingItem.quantity--;
                } else {
                    cart = cart.filter(item => item.id != productId);
                }
                saveCart(cart);
                renderCart();
            };

            // Event listener untuk tombol Tambah/Kurang di Keranjang
            cartList.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const id = e.target.dataset.id;
                    addToCart(id);
                }
                if (e.target.classList.contains('remove-from-cart-btn')) {
                    const id = e.target.dataset.id;
                    removeFromCart(id);
                }
            });
            
            // Event listener untuk tombol 'Tambah ke Keranjang'
            productList.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const id = e.target.dataset.id;
                    addToCart(id);
                }
            });

            // Checkout via WhatsApp
            checkoutButton.addEventListener('click', () => {
                const cart = getCart();
                if (cart.length === 0) return;

                let message = 'Halo, saya ingin memesan sayuran:\n\n';
                let total = 0;
                cart.forEach(item => {
                    message += `${item.quantity}x ${item.name} (@Rp${item.price.toLocaleString('id-ID')})\n`;
                    total += item.price * item.quantity;
                });
                message += `\nTotal: Rp${total.toLocaleString('id-ID')}\n\nTerima kasih!`;
                
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${WA_NUMBER}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
            });
            
            // Login Admin
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                    localStorage.setItem('isLoggedIn', 'true');
                    showPage('admin-page');
                    renderAdminProducts();
                    loginError.classList.add('hidden');
                } else {
                    loginError.classList.remove('hidden');
                }
            });

            // Logout Admin
            logoutButton.addEventListener('click', () => {
                localStorage.removeItem('isLoggedIn');
                showPage('home-page');
                alert('Anda telah logout dari Admin Panel.');
            });

            // Admin Panel
            const renderAdminProducts = () => {
                adminProductList.innerHTML = '';
                const products = getProducts();
                if (products.length === 0) {
                    adminProductList.innerHTML = '<p class="text-center text-gray-500">Belum ada produk.</p>';
                }
                products.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'flex justify-between items-center bg-white p-4 rounded-lg shadow-sm';
                    productItem.innerHTML = `
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800">${product.name}</h4>
                            <p class="text-green-600">Rp${product.price.toLocaleString('id-ID')}</p>
                        </div>
                        <button data-id="${product.id}" class="delete-product-btn bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg transition duration-300">
                            Hapus
                        </button>
                    `;
                    adminProductList.appendChild(productItem);
                });
            };

            // Tambah Produk via Admin Panel
            addProductForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const fileInput = document.getElementById('product-image');
                const file = fileInput.files[0];

                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imageBase64 = event.target.result;
                        const products = getProducts();
                        const newProduct = {
                            id: Date.now(), // ID unik berdasarkan timestamp
                            name: document.getElementById('product-name').value,
                            price: parseInt(document.getElementById('product-price').value),
                            description: document.getElementById('product-desc').value,
                            image: imageBase64
                        };
                        products.push(newProduct);
                        localStorage.setItem('products', JSON.stringify(products));
                        addProductForm.reset();
                        alert('Produk berhasil ditambahkan!');
                        renderProducts(); // Perbarui tampilan di halaman Katalog
                        renderAdminProducts(); // Perbarui tampilan di halaman Admin
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Mohon unggah gambar produk.');
                }
            });

            // Hapus Produk dari Admin Panel
            adminProductList.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-product-btn')) {
                    const id = e.target.dataset.id;
                    let products = getProducts();
                    products = products.filter(p => p.id != id);
                    localStorage.setItem('products', JSON.stringify(products));
                    alert('Produk berhasil dihapus!');
                    renderProducts();
                    renderAdminProducts();
                }
            });

            // Inisialisasi awal
            renderProducts();
            renderCart();
            if (localStorage.getItem('isLoggedIn') === 'true') {
                showPage('admin-page');
                renderAdminProducts();
            } else {
                showPage('home-page');
            }
        });
    </script>

</body>
</html>
